<?php

namespace AirAtlantique\FlightBundle\Entity;

use Doctrine\ORM\EntityRepository;
use \DateTime;

/**
 * FlightRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class FlightRepository extends EntityRepository
{
  public function findFlightByParameters($data)
    {
      $query = $this->createQueryBuilder('myflights');

      $query->where('myflights.departureCity = :departureCity ')
            ->andWhere('myflights.destinationCity = :destinationCity')
            ->setParameters(array(
              'departureCity'   => $data['departureCity'],
              'destinationCity' => $data['destinationCity'],            
          ));
     
      $date = date_format($data['departureDate'], 'd/m/Y H:i:s');
      echo $date;

      if($date !== null){
        $query->andWhere('myflights.departureDate >= :departureDate')
              ->setParameter('departureDate', new \DateTime($date), \Doctrine\DBAL\Types\Type::DATETIME);
      }

      return $query->getQuery()->getResult();
    }
}
