<?php

namespace AirAtlantique\FlightBundle\Entity;

use Doctrine\ORM\EntityRepository;
use \DateTime;

/**
 * FlightRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class FlightRepository extends EntityRepository
{
  public function findFlightByParameters($data)
    {
      $query = $this->createQueryBuilder('myflights');

      $query->where('myflights.departureCity = :departureCity ')
            ->andWhere('myflights.destinationCity = :destinationCity')
            ->setParameters(array(
              'departureCity'   => $data['departureCity'],
              'destinationCity' => $data['destinationCity'],            
          ));
      $date = DateTime::createFromFormat('d/m/Y', $data['departureDate']);

      if($date !== null){
        $query->andWhere('myflights.departureDate >= :departureDate')
              ->setParameter('departureDate', $date);
      }

      return $query->getQuery()->getResult();
    }
}
